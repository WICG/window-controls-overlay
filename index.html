<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>
      Window Controls Overlay
    </title>
    <script src="https://www.w3.org/Tools/respec/respec-w3c" class="remove"
    defer></script>
    <script class="remove">
      // All config options at https://respec.org/docs/
      var respecConfig = {
        specStatus: "CG-DRAFT",
        editors: [{ name: "Diego Gonz√°lez",
                    url: "https://twitter.com/diekus",
                    company: "Microsoft",
                    companyURL: "https://www.microsoft.com"}],
        github: "WICG/window-controls-overlay",
        xref: ["web-platform"
          , "infra"
          , "WebIDL"
          , "DOM"
          , "HTML"
          , "geometry-1"
          , "appmanifest"],
        group: "wicg",

      };
    </script>
  </head>
  <body>
    <section id="abstract">
      <p>
        This document specifies a set of technologies that allow a Web
        developer to customize the title bar of an installed web application
        running in a desktop environment. These technologies are known as
        Window Controls Overlay (<abbr title=
        "Window Controls Overlay">WCO</abbr>).
      </p>
    </section>
    <section id="sotd">
      <p>
        This draft is meant to serve as a starting point for the
        standardization process of WCO and the technologies described in it
        might be migrated to other specifications on different working groups.
      </p>
    </section>
    <section class="informative">
      <h2>
        Introduction
      </h2>
      <p>
        Applications targeting non-mobile devices are hosted within frames that commonly have a title bar. A title bar is a UI element generally represented as a horizontal bar at the top of a window, bearing the name of the active program or the name of the current active document and and the [=window controls=]. The <dfn data-lt="controls of the window">window controls</dfn> are the interface elements that the operating system uses consistently across applications to enable the user to perform certain actions to control the application. Common actions in the [=window controls=] include minimize, maximize/restore, and close buttons.</p>
      <p> For installed web apps hosted within a user agent (UA) frame, it is possible to declare which type of frame to use via the browser display mode. Developers can select the mode that best meets the needs of the application via the [=manifest=] file's `display` member. Developers targeting non-mobile devices looking to create an immersive, native-like title bar for their installed application may want to utilize the title bar area, but this is not supported via the aforementioned `display` member. Instead, the client area begins immediately below the reserved title bar region, which can create a cramped application space specially on portable devices with smaller screens.
      </p>
      <p>
        <dfn>Window Controls Overlay</dfn> is a feature for installed web applications running on non-mobile environments that addresses this challenge by introducing a set
        of technologies throughout JS and CSS that allow to the web content
        area to expand over the [=title bar area=]. When WCO is enabled, the <dfn>title bar area</dfn> is the the region of the window frame occupied by the title bar without the area
        corresponding to the <dfn data-lt="overlaid">overlay</dfn> that houses the [=controls of the window=].
      </p>
    </section>
    <section>
      <h2>
        Extensions to the `Navigator` interface
      </h2>
      <p>
        The [[HTML]] specification defines the <dfn>Navigator</dfn> interface,
        which this specification extends:
      </p>
      <pre class="idl">
        [SecureContext, Exposed=(Window)]
        partial interface Navigator {
          [SameObject] readonly attribute WindowControlsOverlay windowControlsOverlay;
        };
      </pre>
      <section>
        <h3>
          `windowControlsOverlay` attribute
        </h3>
        <p>
          The {{navigator.windowControlsOverlay}} attribute is an instance of
          {{WindowControlsOverlay}}. This attribute provides the current
          visibility of the overlay, the bounding rectangular area of the
          overlay, and whether there was an `ongeometrychange` event to that area
          of the overlay. The <a>user agent</a> MUST run the <a>update the
          overlay area information</a> algorithm steps to initialize the values
          and return the {{Navigator.windowControlsOverlay}} attribute.
        </p>
        </section>
      </section>
        <section>
          <h2>Extensions to the `Window` interface</h2>
        <section>
          <h3>
            Internal slots
          </h3>
          <table class="simple">
            <thead>
              <tr>
                <th>
                  Internal slot
                </th>
                <th>
                  Initial value
                </th>
                <th>
                  Description
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <dfn>[[\TitleBarArea]]</dfn>
                </td>
                <td>
                  An object with empty values that define the title bar area.
                </td>
                <td>
                  An <a>object</a> that stores the values of the environmental variables and JS APIs that define the title bar area.
                </td>
              </tr>
            </tbody>
          </table>
        
      </section>
    </section>
    <section data-dfn-for='WindowControlsOverlay' data-link-for=
    'WindowControlsOverlay'>
      <h2>
        <dfn>WindowControlsOverlay</dfn> interface
      </h2>
      <pre class='idl' data-cite="DOM HTML">
        [Exposed=Window]
        interface WindowControlsOverlay : EventTarget {
          readonly attribute boolean visible;
          DOMRect getBoundingClientRect();
          attribute EventHandler ongeometrychange;
        };

        [Exposed=Window]
        interface WindowControlsOverlayGeometryChangeEvent : Event {
          constructor(DOMString type, WindowControlsOverlayGeometryChangeEventInit eventInitDict);
          [SameObject] readonly attribute DOMRect boundingRect;
          readonly attribute boolean visible;
        };
      </pre>
      <section>
        <h3>
          The <dfn>visible</dfn> attribute
        </h3>
        <p>
          The `visible` attribute is a boolean that determines if the window
          controls overlay has been rendered.
        </p>
      </section>
      <section>
        <h3>
          The <dfn>getBoundingClientRect</dfn> method
        </h3>
        <p>
          The `getBoundingClientRect()` method returns a DOMRect that
          represents the available area for displaying web content. This available title bar region does not include the area under the [=window controls=] [=overlay=]. Web content
          SHOULD not be displayed beneath the overlay.
          <aside class="note">
            <p>
              The client viewport does not make any special considerations when rendering content with the WCO feature enabled. The content will be displayed in the same way that it would be displayed inside the browser window. In order to avoid content being hidden by the area where the [=window controls=] are [=overlaid=], developers must use the `getBoundingClientRect` method or the [=title bar area env variables=].
            </p>
          </aside>
        </p>
      </section>
      <section>
        <h3>
          The <dfn>ongeometrychange</dfn> attribute
        </h3>
        <p>
          The `ongeometrychange` attribute is an event handler whose
          corresponding event handler event type is "change". The event is dispatched when the available title bar region changes, e.g., in response to the UA displaying the scope's origin during the launch of the app, an extension or feature like file access or download displaying an icon as part of the [=window controls=] [=overlay=], or the window being resized.
        </p>
        <p>The event must follow these steps:</p>
        <ol>
          <li></li>
        </ol>
      </section>
    </section>
    <section>
      <h2>
        Addition of `window-controls-overlay` to the manifest
      </h2>
      <p>
        To enable the WCO feature, a new value will be added to the
        `display-override` member of the manifest file. When the
        `window-controls-overlay` value is specified in the `display-override`
        the user agent SHOULD extend the client area to the title bar.
      </p>
    </section>
    <section>
      <h2>
        <dfn>Title bar area environmental variables</dfn>
      </h2>
      <aside class="issue">
        <p>
          This is draft text for features that might belong in other
          specifications. This document might not be the final venue for some
          of the work specified in this draft.
        </p>
      </aside>
      <section>
        <h3>
          <dfn>Title bar area env variables</dfn>
        </h3>
        <table dfn-type="value" dfn-for="env()">
          <tr>
            <th>Name
            <th>Value
          <tr>
            <td><dfn>`titlebar-area-x`</dfn>
            <td><a href="https://drafts.csswg.org/css-values-3/#length-value"> length</a>
          <tr>
            <td><dfn>`titlebar-area-y`</dfn>
            <td><a href="https://drafts.csswg.org/css-values-3/#length-value"> length</a>
          <tr>
            <td><dfn>`titlebar-area-width`</dfn>
            <td><a href="https://drafts.csswg.org/css-values-3/#length-value"> length</a>
          <tr>
            <td><dfn>`titlebar-area-height`</dfn>
            <td><a href="https://drafts.csswg.org/css-values-3/#length-value"> length</a>
        </table>
        <p>
          The [=title bar area environmental variables=] are four env variables
          that define a rectangle by the width and height from a starting point
          in the viewport. This area corresponds to the available area of the
          title bar, and allows to position dynamic Web content inside its
          bounds.
        </p>
      </section>
    </section>
    <section>
      <h2>
        Defining draggable sections
      </h2>
      <p>
        To define which regions or elements in the title bar are draggable,
        this specification defines the CSS `app-region` property.
      </p>
    </section>
    <section>
      <h2>
        Algorithms
      </h2>
      <section>
        <h3>
          Update the overlay area information
        </h3>
        <p>
          To <dfn>update the overlay area information</dfn>, run these steps:
        </p>
        <ol class="algorithm">
          <li>
            Let |ovls| be a [=list=] of regions defined by the [=overlays=] that house the [=window controls=] on the the window frame.
          </li>
          <ol>
            <li>If there is only one overlay region in |ovls|, let |tba| be a {{DOMRect}} object that encompasses the area from the edge of the frame to the start of the |ovls|.</li>
            <li>If there is more than one overlay region in |ovls|, let |tba| be a  {{DOMRect}} object that encompasses the area left between the intersection of the regions in |ovls| and the [=document=]'s <a href="https://drafts.csswg.org/css2/#viewport">viewport</a>.</li>
            <li>The resulting area's height is the same as the height of the regions in |ovls|.</li>
          </ol>
        <li>Scale |tba| to the match the set scaling of the [=document=]'s <a href="https://drafts.csswg.org/css2/#viewport">viewport</a>.</li>
        <li>Make {{window}}.[[\TitleBarArea]] equal to |tba|.</li>
          <li>Update the [=title bar area env variables=] with information from {{navigator}}.[[\TitleBarArea]].</li>
        </ol>
      </section>
    </section>
    <section id="conformance"></section>
  </body>
</html>
